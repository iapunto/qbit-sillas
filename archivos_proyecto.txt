

/* ===================== Archivo: .eslintrc.json ===================== */

{
    "env": {
      "browser": true,
      "node": true,
      "es2021": true
    },
    "extends": [
      "eslint:recommended",
      "plugin:@typescript-eslint/recommended",
      "plugin:builderbot/recommended"
    ],
    "parser": "@typescript-eslint/parser",
    "parserOptions": {
      "ecmaVersion": "latest",
      "sourceType": "module"
    },
    "plugins": ["@typescript-eslint", "builderbot"],
    "rules": {
      "@typescript-eslint/no-explicit-any": "off",
      "@typescript-eslint/no-unused-vars": "off",
      "@typescript-eslint/ban-ts-comment": "off",
      "@typescript-eslint/ban-types": "off",
      "no-unsafe-optional-chaining": "off"
    }
  }
  

/* ===================== Archivo: nodemon.json ===================== */

{
    "watch": ["src"],
    "ext": "ts",
    "ignore": [
      "**/*.test.ts",
      "**/*.spec.ts"
  ],
    "delay": "3",
    "execMap": {
      "ts": "tsx"
    }
  }

/* ===================== Archivo: package.json ===================== */

{
  "name": "base-bailey-json",
  "version": "1.0.0",
  "description": "",
  "main": "dist/app.js",
  "type": "module",
  "scripts": {
    "start": "node ./dist/app.js",
    "lint": "eslint . --no-ignore",
    "dev": "npm run lint && nodemon ./src/app.ts",
    "build": "npx rollup -c"
  },
  "keywords": [],
  "dependencies": {
    "@builderbot-plugins/gemini-layer": "^0.0.2",
    "@builderbot-plugins/url-to-base64": "^1.0.0",
    "@builderbot/bot": "1.2.5",
    "@builderbot/provider-meta": "1.2.5",
    "@google/generative-ai": "^0.24.0",
    "@langchain/core": "^0.3.48",
    "@langchain/google-genai": "^0.2.4",
    "date-fns": "^4.1.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.30",
    "@typescript-eslint/eslint-plugin": "^7.2.0",
    "@typescript-eslint/parser": "^7.4.0",
    "eslint": "^8.52.0",
    "eslint-plugin-builderbot": "latest",
    "nodemon": "^3.1.0",
    "rollup": "^4.10.0",
    "rollup-plugin-typescript2": "^0.36.0",
    "tsx": "^4.7.1",
    "typescript": "^5.4.3"
  },
  "author": "",
  "license": "ISC"
}

/* ===================== Archivo: src\app.ts ===================== */

import { createBot, createFlow } from "@builderbot/bot";
import { MemoryDB } from "@builderbot/bot";

import dotenv from "dotenv";
dotenv.config();

import welcomeFlow from "~/flows/welcomeFlow";
import { provider } from "~/provider";

const PORT = process.env.PORT ?? 3008;

const main = async () => {
  const adapterFlow = createFlow([welcomeFlow]);
  const { httpServer } = await createBot({
    flow: adapterFlow,
    provider,
    database: new MemoryDB(),
  });

  httpServer(+PORT);
};

main();


/* ===================== Archivo: src\flows\welcomeFlow.ts ===================== */

import { EVENTS, addKeyword } from "@builderbot/bot";
import contextLayer from "~/prompts";

export default addKeyword(EVENTS.ACTION).addAction(contextLayer);


/* ===================== Archivo: src\prompts.ts ===================== */

import { geminiLayer } from "@builderbot-plugins/gemini-layer";
import welcomeFlow from "./flows/welcomeFlow";

const visionPrompt = `
        Instrucciones para el BOT :
        Nombre del BOT : SillaBot ü™ë
        Rol : Asistente virtual especializado en ventas y soporte para Sillas.com.co.

        Reglas de Respuesta :
        Saludo Inicial :
        Si el usuario inicia con "hola", "buenos d√≠as", etc., responde:
        "¬°Hola! Soy SillaBot, tu asistente virtual de Sillas.com.co. üòä ¬øBuscas una silla ergon√≥mica para mejorar tu comodidad en el trabajo o estudio?" 
        .
        Mensajes Repetidos o Sin Claridad :
        Si el usuario repite saludos o mensajes vagos, responde:
        "¬øTe gustar√≠a conocer nuestras sillas ergon√≥micas m√°s vendidas, como la Sihoo Doro S300 o la Ergomax M97B? ¬°Son ideales para cuidar tu postura! üõãÔ∏è" 
        .
        Interacciones Prolongadas Sin Intenci√≥n Clara :
        Si tras 5+ mensajes no hay claridad, pregunta:
        "¬°Hola de nuevo! üòä ¬øNecesitas ayuda para elegir una silla, consultar promociones o ver modelos espec√≠ficos?" 
        .
        Consultas Sobre Productos :
        Si el usuario menciona un modelo (ej.: "Sihoo Doro S300"), responde con detalles del JSON:
        "La Sihoo Doro S300 en color negro tiene un precio especial de $3.465.000 COP. ¬°Aprovecha la preventa hasta abril 2025! üõí [Link] " 
        .
        Promociones o Ofertas :
        Si el usuario pregunta por descuentos, menciona:
        "¬°La Sihoo Doro S300 est√° en preventa con 10% OFF! Versi√≥n gris: 3.550.000COP.Reservacon1.000.000 COP. üéâ [Link] " 
        .
        Agendar Contacto o Compras :
        Si el usuario muestra inter√©s en comprar, redirige:
        "¬°Genial! Visita nuestro cat√°logo: sillas.com.co/tienda o escr√≠benos a Instagram (@sillas.com.co) para asesor√≠a. üì≤".

        Respuesta Fuera de Horario :
        Fuera de 9:00‚Äì17:00 (lunes‚Äìviernes):
        "¬°Hola! Nuestro equipo te atender√° en horario laboral. D√©janos un mensaje y te contactaremos. ‚è∞"

        Preguntas Fuera de Alcance :
        Si el usuario pregunta algo no relacionado:
        "Lo siento, no entiendo tu consulta. üòï ¬øTe refieres a nuestras sillas ergon√≥micas o promociones?"

        Informaci√≥n de Sillas.com.co :
        Qui√©nes Somos :
        Especialistas en sillas ergon√≥micas para oficina y estudio.

        Modelos destacados:
        Sihoo Doro S300 : Reclinaci√≥n antigravedad y soporte lumbar.
        Ergomax M97B : Ajustes de altura y reposabrazos 4D.

        Promociones Vigentes :
        Preventa Sihoo Doro S300 : Hasta el 30/04/2025 con 10% OFF.

        Lista de Productos Disponibles :
        [  
            {  
                "name": "Silla Ergon√≥mica Sihoo Doro S300 - Gris",  
                "price": "$3.550.000",  
                "link": "https://sillas.com.co/tienda/silla-sihoo-doro-s300/?attribute_color=Gris"  
            },  
            {  
                "name": "Silla Ergon√≥mica Sihoo Doro S300 - Negro",  
                "price": "$3.465.000",  
                "link": "https://sillas.com.co/tienda/silla-sihoo-doro-s300/?attribute_color=Negro"  
            },  
            {  
                "name": "Silla de Oficina Ergon√≥mica Sihoo M102",  
                "price": "$683.000",  
                "link": "https://sillas.com.co/tienda/silla-de-oficina-ergonomica-sihoo-m102/"  
            },  
            {  
                "name": "Silla Ergon√≥mica Sihoo Presidencial Star V1",  
                "price": "$2.250.000",  
                "link": "https://sillas.com.co/tienda/silla-sihoo-presidencial-star-v1/"  
            },  
            {  
                "name": "Silla Ergon√≥mica Sihoo Doro C300 Pro",  
                "price": "$2.650.000 ‚Äì $2.735.000",  
                "link": "https://sillas.com.co/tienda/silla-ergonomica-sihoo-doro-c300-pro/"  
            },  
            {  
                "name": "Silla Ergon√≥mica Sihoo Ergomax M97B",  
                "price": "$2.600.000",  
                "link": "https://sillas.com.co/tienda/silla-ergonomica-sihoo-ergomax-m97b/"  
            },  
            {  
                "name": "SILLA GERENCIAL DELPHI ALUMINIO",  
                "price": "$680.000",  
                "link": "https://sillas.com.co/tienda/silla-gerencial-delphi-aluminio/"  
            },  
            {  
                "name": "SILLA GERENCIAL DELPHI BASE NEGRA",  
                "price": "$600.000",  
                "link": "https://sillas.com.co/tienda/silla-gerencial-delphi-base-negra/"  
            },  
            {  
                "name": "SILLA GERENCIAL NEFI GRIS",  
                "price": "$1.900.000",  
                "link": "https://sillas.com.co/tienda/silla-gerencial-nefi-gris/"  
            },  
            {  
                "name": "SILLA OPERATIVA DELPHI BASE NEGRA",  
                "price": "$450.000",  
                "link": "https://sillas.com.co/tienda/silla-operativa-delphi-base-negra/"  
            },  
            {  
                "name": "SILLA OPERATIVA DELPHI CROMADA",  
                "price": "$485.000",  
                "link": "https://sillas.com.co/tienda/silla-operativa-delphi-cromada/"  
            },  
            {  
                "name": "SILLA PRESIDENCIAL MANHATTAN ECO",  
                "price": "$1.700.000",  
                "link": "https://sillas.com.co/tienda/silla-presidencial-manhattan-eco/"  
            },  
            {  
                "name": "SILLA PRESIDENCIAL NIZA",  
                "price": "$465.000",  
                "link": "https://sillas.com.co/tienda/silla-presidencial-niza/"  
            },  
            {  
                "name": "SILLA PRESIDENCIAL OSAKA",  
                "price": "$818.678",  
                "link": "https://sillas.com.co/tienda/silla-presidencial-osaka/"  
            },  
            {  
                "name": "SILLA SIHOO S50",  
                "price": "$1.850.000 (Agotado)",  
                "link": "https://sillas.com.co/tienda/silla-sihoo-s50/"  
            },  
            {  
                "name": "SILLA THINK GERENTE NEGRA",  
                "price": "$750.000",  
                "link": "https://sillas.com.co/tienda/silla-think-gerente-negra/"  
            }  
        ]  

        Contacto :
        Instagram: @sillas.com.co (11K seguidores).
        Sitio web: sillas.com.co .
        WhatsApp: +57 316 376 9935 (ejemplo).
        Historial de Conversaci√≥n :
        {HISTORY}

        Mensaje del Usuario :
        {MESSAGE}

        Formato de Respuesta :
        Lenguaje amigable, emojis relacionados (ü™ë, üõí, üéâ).
        Prioridad a redirigir a ventas o contacto directo.
        `;

export default async (...bot: any) =>
  await geminiLayer(
    {
      vision: true,
      visionPrompt,
    },
    bot
  );


/* ===================== Archivo: src\provider.ts ===================== */

import { createProvider } from "@builderbot/bot";
import { MetaProvider } from "@builderbot/provider-meta";

export const provider = createProvider(MetaProvider, {
  jwtToken: process.env.JWT_TOKEN!,
  numberId: process.env.NUMBER_ID!,
  verifyToken: process.env.VERIFY_TOKEN!,
  version: process.env.VERSION!,
});


/* ===================== Archivo: src\services\ai.ts ===================== */

import { GoogleGenerativeAI } from "@google/generative-ai";

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY!);
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

export async function generateResponse(userMessage: string): Promise<string> {
  const COMPANY_INFO = `
    Empresa: Sillas.com.co
    Especialidad: Sillas ergon√≥micas para oficina y estudio
    Productos destacados: 
      - Sihoo Doro S300 (Negro/Gris)
      - Ergomax M97B
      - Sihoo Presidencial Star V1
    Promociones vigentes: 
      - Preventa Sihoo Doro S300 hasta abril 2025 (10% OFF)
    Contacto: 
      Instagram: @sillas.com.co
      WhatsApp: +57 316 376 9935
  `;

  const prompt = `
    Eres un asistente de ventas para Sillas.com.co.
    Informaci√≥n de la empresa: ${COMPANY_INFO}
    Historial de conversaci√≥n: {history}
    Mensaje del usuario: ${userMessage}
    Respuesta: 
  `;

  try {
    const result = await model.generateContent(prompt);
    return result.response.text();
  } catch (error) {
    console.error("Error en generaci√≥n IA:", error);
    return "Ocurri√≥ un error al procesar tu solicitud. Por favor intenta m√°s tarde.";
  }
}


/* ===================== Archivo: src\test_gemini.ts ===================== */

import { GoogleGenerativeAI } from "@google/generative-ai";
import dotenv from "dotenv";

dotenv.config(); // Carga variables de entorno desde .env

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY!);
const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });

async function testGemini() {
  try {
    const prompt = "Explica c√≥mo funciona la energ√≠a solar en 3 puntos clave";
    const result = await model.generateContent(prompt);
    const response = await result.response;
    console.log("Respuesta de Gemini:");
    console.log(response.text());
  } catch (error) {
    console.error("Error al usar Gemini:", error);
  }
}

testGemini();


/* ===================== Archivo: src\utils.ts ===================== */



/* ===================== Archivo: tsconfig.json ===================== */

{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "declaration": false,
    "declarationMap": false,
    "moduleResolution": "node",
    "removeComments": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "allowSyntheticDefaultImports": true,
    "sourceMap": false,
    "outDir": "./dist",
    "baseUrl": "./",
    "rootDir": "./",
    "incremental": true,
    "skipLibCheck": true,
    "paths": {
      "~/*": ["./src/*"]
    }
  },
  "include": [
    "**/*.js",
    "**/*.ts"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts",
    "**/*.spec.ts",
    "**e2e**",
    "**mock**"
  ]
}